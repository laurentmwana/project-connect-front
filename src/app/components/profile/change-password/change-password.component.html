<div class="max-w-3xl">
  <div class="rounded-lg border p-6 md:p-8">
    <div class="space-y-6">
      <div>
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
          Mettre à jour le mot de passe
        </h2>
        <p class="text-gray-600 dark:text-gray-400 text-sm">
          Entrez votre ancien mot de passe et définissez un nouveau.
        </p>
      </div>

      <!-- Erreur globale -->
      <div *ngIf="success" class="text-green-600 text-sm font-medium mb-5">
        {{ success }}
      </div>

      <form
        [formGroup]="changePasswordForm"
        (ngSubmit)="onSubmit()"
        class="space-y-5"
        novalidate
      >
        <!-- Ancien mot de passe -->
        <div>
          <label
            for="current-password"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Ancien mot de passe
          </label>
          <input
            [disabled]="isPending"
            id="current-password"
            type="password"
            formControlName="current_password"
            placeholder="Votre mot de passe actuel"
            name="currentPassword"
            class="input-field"
            [class.border-red-500]="isSubmit && f['current_password'].invalid"
          />
          <div
            *ngIf="isSubmit && f['current_password'].errors"
            class="text-red-500 text-sm mt-1"
          >
            <div *ngIf="f['current_password'].errors?.['required']">
              Champ requis.
            </div>
            <div *ngIf="f['current_password'].errors?.['maxlength']">
              Max 255 caractères.
            </div>
            <div *ngIf="f['current_password'].errors?.['email']">
              Doit être une adresse email valide.
            </div>
            <div *ngIf="f['current_password'].errors?.['serverError']">
              {{ f["current_password"].errors["serverError"] }}
            </div>
          </div>
        </div>

        <!-- Nouveau mot de passe -->
        <div>
          <label
            for="new-password"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Nouveau mot de passe
          </label>
          <input
            [disabled]="isPending"
            id="new-password"
            type="password"
            formControlName="password"
            placeholder="Votre nouveau mot de passe"
            name="newPassword"
            class="input-field"
            [class.border-red-500]="isSubmit && f['password'].invalid"
          />
          <div
            *ngIf="isSubmit && f['password'].errors"
            class="text-red-500 text-sm mt-1"
          >
            <div *ngIf="f['password'].errors?.['required']">Champ requis.</div>
            <div *ngIf="f['password'].errors?.['minlength']">
              Minimum 8 caractères.
            </div>
            <div *ngIf="f['password'].errors?.['serverError']">
              {{ f["password"].errors["serverError"] }}
            </div>
          </div>
        </div>

        <!-- Confirmation du mot de passe -->
        <div>
          <label
            for="confirm-password"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Confirmer le nouveau mot de passe
          </label>
          <input
            id="confirm-password"
            type="password"
            [disabled]="isPending"
            formControlName="password_confirmation"
            placeholder="Confirmez votre nouveau mot de passe"
            name="confirmPassword"
            class="input-field"
            [class.border-red-500]="isSubmit && (f['password_confirmation'].invalid || changePasswordForm.errors?.['passwordsMismatch'])"
          />
          <div
            *ngIf="isSubmit && f['password_confirmation'].errors"
            class="text-red-500 text-sm mt-1"
          >
            <div *ngIf="f['password_confirmation'].errors?.['required']">
              Champ requis.
            </div>
            <div *ngIf="f['password_confirmation'].errors?.['minlength']">
              Minimum 8 caractères.
            </div>
          </div>
          <div
            *ngIf="isSubmit && changePasswordForm.errors?.['passwordsMismatch']"
            class="text-red-500 text-sm mt-1"
          >
            Les mots de passe ne correspondent pas.
          </div>
        </div>

        <!-- Erreur globale -->
        <div *ngIf="error" class="text-red-600 text-sm font-medium">
          {{ error }}
        </div>

        <!-- Bouton -->
        <div class="flex justify-start gap-3 pt-3">
          <button type="submit" [disabled]="isPending" class="btn-primary">
            <span *ngIf="!isPending">Mettre à jour</span>

            <span *ngIf="isPending" class="flex items-center gap-2">
              <svg
                class="animate-spin h-4 w-4 text-white dark:text-gray-800"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                role="status"
                aria-label="Chargement"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8z"
                ></path>
              </svg>
              Chargement...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
